(function(f){var e=0,j=1;function c(){this.init.apply(this,arguments);return this}c.prototype={ATTRIBUTES_FILTER:{xmlns:e,id:j,"class":j,name:j,property:j,rel:j,"typeof":j},IMMEDIATE_DESCENDANT:0,DESCEDANT:1,IMMEDIATE_SIBLING:2,SIBLING:3,BREAK:"_break_",init:function m(s,p){this.attributes={};var r=this;filter=p&&p.filter||this.ATTRIBUTES_FILTER;if(s){s=s instanceof f?s[0]:s;var o=f(s);var n={};this.nodeName=s.nodeName;var u=o.attr("id");if(u&&o.document().find('[id="'+u+'"]').length==1){this.id=u;n.id=true}if(s.className){this.className=o.classNames();var t=[];for(var q=0;q<this.className.length;q++){if(!this.className[q].match(/^(sf-|sf_)/)){t.push(this.className[q])}}this.className=t;if(0<this.className.length){n["class"]=true}}if(f.inArray(this.nodeName,["HTML","BODY","HEAD"])==-1){if(o.siblings().size()>0){this.position=1+o.prevAll().size()}}f(s.attributes).filter(function(v){var w=this.nodeName;return(!n[w]&&(filter[w]==j))}).each(function(){r.attributes[this.nodeName]=o.attr(this.nodeName)});if(("relation" in p)&&(this.nodeName!="HTML")){this.relation=p.relation}}return this},toCSS:function(o){o=o||function(){return true};var q=this.className&&f(this.className).filter(function(r){return o("class",r)}).get().join(".");var p=this.nodeName||"";var n=(this.relation==this.IMMEDIATE_DESCENDANT?" > ":" ")+p+(this.id!=undefined?("#"+this.id.replace(/:/,"\\:")):"")+(q?("."+q):"");f.each(this.attributes,function(r,s){if(o(r,s)){n+="["+r+(s?('="'+s+'"'):"")+"]"}});return n+(this.position!=undefined?(this.position==1?":first-child":(":nth-child("+this.position+")")):"")||"*"},toXpath:function(o){var p=this.className&&this.className.join(".");var n=this.nodeName+(this.id?("#"+this.id):"")+(p?("."+p):"");f.each(this.attributes,function(q,r){r=r&&r.match(/_/)?('"'+r+'"'):r;n+="[@"+q+(r?("="+r):"")+"]"});return((this.relation!=this.IMMEDIATE_DESCENDANT)?"//":"/")+n+(this.position?("["+this.position+"]"):"")},match:function(n){var o=(this.nodeName==undefined||this.nodeName==n.nodeName)&&(this.id==undefined||(this.id==n.id));o=o&&((!("relation" in this))||this.relation==n.relation);if(o&&this.clasName){this.className.forEach(function(q){o=o&&n.className&&(f.inArray(q,n.className)!==-1)})}if(o){for(var p in this.attributes){o=o&&n.attributes&&(p in n.attributes)&&(n.attributes[p]===this.attributes[p])}}return o},clone:function(){var n=new c(),p=this;n.nodeName=this.nodeName;n.relation=this.relation;f(["id","position","relation"]).each(function(){n[this]=p[this]});if(this.className){n.className=this.className.slice(0)}for(var o in this.attributes){n.attributes[o]=this.attributes[o]}return n},merge:function(o){var n=new c();var q=this;n.nodeName=(this.nodeName&&(this.nodeName!=o.nodeName))?undefined:this.nodeName;if(("relation" in o)&&("relation" in this)){n.relation=(this.relation!=o.relation)?undefined:this.relation}if(("id" in o)&&("id" in this)){n.id=(this.id!=o.id)?undefined:this.id}if(o.className&&this.className){n.className=f(o.className).filter(function(){return f.inArray(this,q.className)!=-1}).get()}for(var p in this.attributes){if(this.attributes[p]){if(o.attributes[p]){if(this.attributes[p]!=o.attributes[p]){n.attributes[p]=undefined}}}}return n},toString:function(){return this.toCSS()}};function l(n){return n instanceof b.constructor?n:(n instanceof f?n[a]():f(n)[a]())}var a="domselector";var k={};f(["push","pop","reverse","shift","sort","splice","unshift","concat"]).each(function(){var n=this;k[n]=Array.prototype[n]});var b=f.klass(a,f.extend(k,{ATTRIBUTE_REMOVE:e,IMMEDIATE_DESCENDANT:0,DESCEDANT:1,IMMEDIATE_SIBLING:2,SIBLING:3,BREAK:"_break_",init:function m(n,q){var p=this;this.length=0;if(n instanceof b.constructor){return n}if(typeof n.attr=="function"){var o=n[0];if(o){f(o).parents().reverse().add(o).filter("*").each(function(){p.push(new c(this,{relation:this.IMMEDIATE_DESCENDANT}))})}}else{if(typeof n=="string"){this.init(f(q).find(n))}}return this},clone:function h(){var n=f([])[a]();this.each(function(){n.push(this.clone())});return n},extend:function g(){this.pop();return this},merge:function i(p,o){var n=this.clone();var q=p instanceof b?f([p]):f(p).map(function(){return f(this)[a]()});q.each(function(){if(n.length>this.length){n.length=this.length}});n.each(function(s){var r=this;q.each(function(){r=r.merge(this[s])});n[s]=r});return n},select:function(n){return f(n).find(this.toCSS())},filterAttributes:function(o){var n=this.clone();n.each(function(){if(this.className){this.className=this.className.filter(function(q){return o("class",q)})}for(var p in this.attributes){if(!o(p,this.attributes[p])){delete (this.attributes[p])}}});return n},noPosition:function(o){var n=this.clone();n.each(function(){if(this.position){delete (this.position)}});return n},relativize:function d(n){var o=this.clone();n=l(n);n.each(function(){while((o.length>0)&&!this.match(o.shift())){}});return o},simplify:function(n){if(!n.nodeType){throw new Error("container undefined")}var t=this.clone(),p=this;function s(v,u){if(v.length!=u.length){return false}for(var w=0;w<v.length;w++){if(v[w]!==u[w]){return false}}return true}var o=this.select(n);if(o.length>0){var r,q;while(t.length>0&&s(o,t.select(n))){r=t.shift();if(t[0]){q=t[0].relation;t[0].relation=this.DESCENDANT}}if(r){if(t[0]&&q!==undefined){t[0].relation=q}t.unshift(r)}t.each(function(u){var x=t[u].position;delete (t[u].position);if(!s(o,t.select(n))){t[u].position=x}if("className" in t[u]&&t[u].className&&t[u].className.length>0){var w,z;while((w=t[u].className.shift())&&(z=s(o,t.select(n)))){}if(!z&&w){t[u].className.unshift(w)}}if("attributes" in t[u]&&t[u].attributes&&t[u].attributes.length>0){var v,z;while((v=t[u].attributes.shift())&&(z=s(o,t.select(n)))){}if(!z&&v){t[u].attributes.unshift(v)}}if(t[u].id!=undefined||(t[u].className&&t[u].className.length>0)||(t[u].attributes&&t[u].attributes.length>0)){var y=t[u].nodeName;t[u].nodeName=undefined;if(!s(o,t.select(n))){t[u].nodeName=y}}})}return t},toCSS:function(n){return this.map(function(){return this.toCSS(n)}).get().join(" ")},toXpath:function(){}}))})(jQuery);